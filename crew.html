<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Air Crew Pickup Request - Travylway</title>

<style>
:root{--bg:#2B3A4A;--accent:#2563EB;--text:#0F172A;--light:#E5E7EB}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--light);padding:2rem 1rem}
.container{max-width:700px;margin:0 auto}
.form-card{background:white;border-radius:20px;padding:2.5rem;box-shadow:0 20px 60px rgba(0,0,0,.3);color:var(--text)}
.form-header{text-align:center;margin-bottom:2rem}
.form-header h1{font-size:2rem;margin-bottom:.5rem;color:#333}
.form-group{margin-bottom:1.5rem}
.form-group label{display:block;font-weight:700;margin-bottom:.5rem;color:#333}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:.75rem;border:2px solid #e0e0e0;border-radius:10px}
.submit-btn{width:100%;padding:1rem;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:12px;font-size:1.1rem;font-weight:900}
.success-message,.error-message{padding:1rem;border-radius:10px;margin-bottom:1.5rem;text-align:center;font-weight:600;display:none}
.success-message{background:#d4edda;color:#155724}
.error-message{background:#f8d7da;color:#721c24}
.calc-btn{background:#2196f3;color:white;border:none;padding:.75rem;border-radius:8px;width:100%;font-weight:700}
.price-estimate{background:#e3f2fd;padding:1.5rem;border-radius:10px;margin:1.5rem 0;display:none}
.price{font-size:1.8rem;font-weight:900}
</style>
</head>

<body>
<div class="container">
<div class="form-card">

<div class="form-header">
<h1>‚úàÔ∏è Airline Crew Transportation</h1>
<p>Special discounted rates for airline crew members</p>
</div>

<div id="successMessage" class="success-message">‚úì Request submitted successfully!</div>
<div id="errorMessage" class="error-message"></div>

<form id="pickupForm">

<div class="form-group">
<label>Name *</label>
<input id="name" required>
</div>

<div class="form-group">
<label>Pickup Address *</label>
<input id="address" required placeholder="Enter address or choose below">
</div>

<!-- GREEN VALLEY RANCH DROPDOWN -->
<div class="form-group" id="gvrDropdown" style="display:none;">
<label style="color:#1565c0;font-weight:900;">üè† Green Valley Ranch Crash Pads</label>
<select id="gvrAddress">
<option value="">-- Select Crash Pad Address --</option>
<option value="4909 Green Valley Ranch Blvd, Denver, CO 80249">4909 Green Valley Ranch Blvd</option>
<option value="5489 Netherland St, Denver, CO 80249">5489 Netherland St</option>
<option value="5800 Tower Rd, Denver, CO 80249">5800 Tower Rd</option>
<option value="18001 E 47th Dr, Denver, CO 80249">18001 E 47th Dr</option>
<option value="18109 E 51st Pl, Denver, CO 80249">18109 E 51st Pl</option>
<option value="18113 E 51st Ave, Denver, CO 80249">18113 E 51st Ave</option>
<option value="20040 Mitchell Cir, Denver, CO 80249">20040 Mitchell Cir</option>
</select>
</div>

<div class="form-group">
<label>Airport *</label>
<input id="airport" value="Denver International Airport" required>
</div>

<div class="form-group">
<label>Service Type *</label>
<select id="serviceType" required>
<option value="">Select</option>
<option value="pickup">Airport Pickup</option>
<option value="dropoff">Airport Dropoff</option>
</select>
</div>

<button type="submit" class="submit-btn" id="submitBtn">Submit Request</button>
</form>

</div>
</div>

<script>
const API_URL = "https://travylway-api.benterpryzes2084.workers.dev/api/trips";

// Show GVR dropdown if arriving from card
const params = new URLSearchParams(window.location.search);
if (params.get("location") === "gvr") {
  document.getElementById("gvrDropdown").style.display = "block";
}

// Auto-fill address when dropdown selected
document.getElementById("gvrAddress").addEventListener("change", e => {
  if (e.target.value) {
    document.getElementById("address").value = e.target.value;
  }
});

document.getElementById("pickupForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const errorMsg = document.getElementById("errorMessage");
  const successMsg = document.getElementById("successMessage");
  errorMsg.style.display = "none";
  successMsg.style.display = "none";

  const payload = {
    created_by: document.getElementById("name").value,
    pickup_text: document.getElementById("address").value,
    dropoff_text: document.getElementById("airport").value,
    pickup_time_utc: new Date().toISOString(),
    trip_type: "AIRPORT",
    rider_type: "CREW",
    direction: document.getElementById("serviceType").value === "pickup" ? "FROM_AIRPORT" : "TO_AIRPORT",
    airport_code: "DEN"
  };

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const data = await res.json();
    if (!res.ok) throw new Error(data.error || "Request failed");

    successMsg.style.display = "block";
    e.target.reset();
  } catch (err) {
    errorMsg.textContent = "‚úó " + err.message;
    errorMsg.style.display = "block";
  }
});
</script>

</body>
</html>

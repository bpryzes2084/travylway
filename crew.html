<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Air Crew Pickup Request - Travylway</title>

<style>
:root{--bg:#2B3A4A;--accent:#2563EB;--text:#0F172A;--light:#E5E7EB}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--light);padding:2rem 1rem}
.container{max-width:700px;margin:0 auto}
.form-card{background:white;border-radius:20px;padding:2.5rem;box-shadow:0 20px 60px rgba(0,0,0,.3);color:var(--text)}
.form-header{text-align:center;margin-bottom:2rem}
.form-header h1{font-size:2rem;margin-bottom:0.5rem;color:#333}
.form-header p{color:#666}
.form-group{margin-bottom:1.5rem}
.form-group label{display:block;font-weight:700;margin-bottom:0.5rem;color:#333}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:.75rem;border:2px solid #e0e0e0;border-radius:10px;font-size:1rem}
.submit-btn{width:100%;padding:1rem;background:linear-gradient(135deg,#667eea,#764ba2);color:white;border:none;border-radius:12px;font-size:1.1rem;font-weight:900;cursor:pointer}
.success-message,.error-message{padding:1rem;border-radius:10px;margin-bottom:1.5rem;text-align:center;font-weight:600;display:none}
.success-message{background:#d4edda;color:#155724}
.error-message{background:#f8d7da;color:#721c24}
.calc-btn{background:#2196f3;color:white;border:none;padding:.75rem;border-radius:8px;width:100%;font-weight:700}
.price-estimate{background:#e3f2fd;padding:1.5rem;border-radius:10px;margin:1.5rem 0;display:none}
.price{font-size:1.8rem;font-weight:900}
</style>
</head>

<body>
<div class="container">
<div class="form-card">

<div class="form-header">
<h1>✈️ Airline Crew Transportation</h1>
<p>Special discounted rates for airline crew members</p>
</div>

<div id="successMessage" class="success-message">✓ Request submitted successfully!</div>
<div id="errorMessage" class="error-message"></div>

<form id="pickupForm">

<div class="form-group">
<label>Name *</label>
<input id="name" required>
</div>

<div class="form-group">
<label>Pickup Address *</label>
<input id="address" required>
</div>

<div class="form-group">
<label>Airport *</label>
<input id="airport" value="Denver International Airport" required>
</div>

<div class="form-group">
<label>Service Type *</label>
<select id="serviceType" required>
<option value="">Select</option>
<option value="pickup">Pickup</option>
<option value="dropoff">Dropoff</option>
</select>
</div>

<button type="button" class="calc-btn" id="calcBtn">Calculate Price</button>

<div id="priceEstimate" class="price-estimate">
<div>Distance: <span id="distanceDisplay">--</span></div>
<div class="price">$<span id="priceDisplay">--</span></div>
</div>

<div class="form-group">
<label>Airline</label>
<input id="airline">
</div>

<div class="form-group">
<label>Flight Number</label>
<input id="flightNumber">
</div>

<div class="form-group">
<label>Notes</label>
<textarea id="notes"></textarea>
</div>

<button type="submit" class="submit-btn" id="submitBtn">Submit Request</button>
</form>

</div>
</div>

<script>
const API_URL = "https://travylway-api.benterpryzes2084.workers.dev/api/trips";

// pricing
const BASE_FARE = 2.25;
const PER_MILE_RATE = 1.25;
const MINIMUM_FARE = 10;
const MAXIMUM_FARE = 15;

let placesService;

function initMap() {
  const map = new google.maps.Map(document.createElement("div"));
  placesService = new google.maps.places.PlacesService(map);
}

document.getElementById("pickupForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const errorMsg = document.getElementById("errorMessage");
  const successMsg = document.getElementById("successMessage");
  errorMsg.style.display = "none";
  successMsg.style.display = "none";

  const payload = {
    created_by: document.getElementById("name").value,
    pickup_text: document.getElementById("address").value,
    dropoff_text: document.getElementById("airport").value,
    pickup_time_utc: new Date().toISOString(),
    trip_type: "AIRPORT",
    rider_type: "CREW",
    direction: document.getElementById("serviceType").value === "pickup" ? "FROM_AIRPORT" : "TO_AIRPORT",
    airport_code: "DEN",
    airline: document.getElementById("airline").value || null,
    flight_number: document.getElementById("flightNumber").value || null,
    notes: document.getElementById("notes").value || null
  };

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const text = await res.text();
    const data = JSON.parse(text);

    if (!res.ok) throw new Error(data.error || "Request failed");

    successMsg.style.display = "block";
    e.target.reset();
  } catch (err) {
    errorMsg.textContent = "✗ " + err.message;
    errorMsg.style.display = "block";
  }
});
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQPVMR-qUW_uDz8TGazVXFP5J8ZEEkEyo&libraries=places&callback=initMap" async defer></script>

</body>
</html>
